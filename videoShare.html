<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>视频</title>
    <link rel="stylesheet" href="./css/reset.css" />
    <link rel="stylesheet" href="./css/video-js.css" /> 
    <link rel="stylesheet" href="./css/newsShare.css" /> 
    	<style>
		.m {
			width: 100%;
			height: 200px;
			margin-left: auto;
			margin-right: auto;
		}
		</style>
		
</head>
<body>
	<div class="m" style="opacity:0;filter:alpha(opacity=0);">
      <video id="my-video" class="video-js myVideo" controls preload="auto" poster="" data-setup="{}" webkit-playsinline="true" playsinline="true">
        <source class="videoSrc" src="http://jq22com.qiniudn.com/jq22-sp.mp4" type="video/mp4">
        <p class="vjs-no-js"> To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a> </p>
      </video>
      <script src="js/video.min.js"></script> 
	  <script src="https://vjs.zencdn.net/5.19/lang/zh-CN.js"></script>
      <script type="text/javascript">
			var myPlayer = videojs('my-video');
			videojs("my-video").ready(function(){
				var myPlayer = this;
				/*myPlayer.play();*/				
			});
			  
		</script> 
    </div>
	<div class="videoCon" style="opacity:0;filter:alpha(opacity=0);">
		<p class="videoName">迪丽热巴《烈火如歌》如歌红衣娇俏惊艳 银雪白衣颠倒娇俏惊艳 银雪白衣颠倒娇俏惊艳 银雪白衣颠倒娇俏惊艳 银雪白衣颠倒</p>
		<div class="videoInfo">
			<span class="videoSource">优酷</span>
			<span class="playCnt">164</span>次播放
		</div>
	</div>
	<section id="main" style="opacity:0;filter:alpha(opacity=0);">				
		<div class="title"><span></span>相关推荐</div>
		<ul class="newsList">
			<!--<a href="">
			<li class="items">
				<div class="leftCon">
					<p>vivo X21屏幕指纹手机发布 鹿晗邀你一起解锁vivoivo X21屏幕指纹手机发布 鹿晗邀你一起解锁viv</p>
					<div class="itemsInfor">
						<span>新华社</span>
						<span>刚刚</span>
						<span>18909</span>阅读
					</div>
				</div>
				<div class="rightImg">
					<img src="./img/userPhoto.jpg" alt="" />
				</div>
			</li>
			</a>-->
		</ul>
	</section>
	<div class="shareLink" style="opacity:0;filter:alpha(opacity=0);">
		<div class="icon"><span></span><span>早头条</span></div>		
		<span>看新闻赚零花钱</span>		
		<a id="linkedME" href="#">打开</a>
	</div>	
</body>
	<script type="text/javascript" src="./js/rem.js"></script>
	<script type="text/javascript" src="./js/jquery-3.3.1.min.js"></script>
	<script type="text/javascript" src="./js/fastclick.js"></script>
	<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
	<script>
		//获取浏览器页面可见高度和宽度  
        var _PageHeight = document.documentElement.clientHeight,  
            _PageWidth = document.documentElement.clientWidth;  
        //计算loading框距离顶部和左部的距离（loading框的宽度为215px，高度为61px）  
        var _LoadingTop = _PageHeight > 61 ? (_PageHeight - 61) / 2 : 0,  
            _LoadingLeft = _PageWidth > 215 ? (_PageWidth - 215) / 2 : 0;  
        //在页面未加载完毕之前显示的loading Html自定义内容  
        var _LoadingHtml = 
        '<div id="loadingDiv" style="position:absolute;left:0;width:100%;height:' + _PageHeight + 'px;top:0;background:url(./img/details_loading.png) no-repeat center center;background-size:100% 100%;opacity:100;filter:alpha(opacity=100);z-index:10000;"></div>';
        //呈现loading效果  
        document.write(_LoadingHtml);  
        //监听加载状态改变  
        document.onreadystatechange = completeLoading;     
        //加载状态为complete时移除loading效果  
        function completeLoading() {  
            if (document.readyState == "complete") {  
                var loadingMask = document.getElementById('loadingDiv');  
                loadingMask.parentNode.removeChild(loadingMask);  
                $("#loadingDiv").remove();
                $("#main").css({"opacity":100,"filter":"alpha(opacity=100)"});
                $(".m").css({"opacity":100,"filter":"alpha(opacity=100)"});
                $(".videoCon").css({"opacity":100,"filter":"alpha(opacity=100)"});
                $(".shareLink").css({"opacity":100,"filter":"alpha(opacity=100)"});                
            }  
        }  
		</script>
	<script type="text/javascript">	
			var videoUrl = window.location.href;
			/*videoUrl = 						
			"https://zhishun520.com/zttH5/videoShare.html?appVersion=1.2.3&backdata=1&brand=apple&channel=APP&domain=https://zhishun888.com:9443/toutiaotv-api-home-1.0.0/&extdata=eyJzdHJhdGVneSI6IjIuNi41MS43Mi5jM2ZqejQ0OW01YjkuOS44eS4yNi52Z2ZnbDQuLjEuMXFicjlwa3BkanI2IiwiY2hhbm5lbF9pZCI6IjI0In0=&height=667&idIdfa=845DC92A-015C-416D-B2A3-C8BC1B2764CC&idImei=xxxx&infoId=PO7rV0PJ3w9b&invitation=U7eQvTsbSfY&ip=36.24.229.181&model=iPhone&osType=2&osVersion=11.3&packageName=com.muki.TopLineTV&page=1&type=1&urls=video/list&userAgent=Mozilla/5.0%20(iPhone;%20CPU%20iPhone%20OS%2011_3%20like%20Mac%20OS%20X)%20AppleWebKit/605.1.15%20(KHTML,%20like%20Gecko)%20Mobile/15E216&userId=343&videoOsType=ios&width=375&****zTitle=EXO%E6%88%90%E5%91%98%E5%86%85%E9%83%A8%E5%A4%96%E8%B2%8C%EF%BC%8C%E5%A4%96%E8%B2%8C%E6%8E%92%E5%90%8D%E5%85%AC%E5%BC%80%EF%BC%8C%E5%BC%A0%E8%89%BA%E5%85%B4%E7%AC%AC4%EF%BC%8C%E5%89%8D%E4%B8%89%E6%98%AF%E4%BB%96%E4%BB%AC%EF%BC%81&****zlink=";//ios*/
/*			videoUrl = 						
			"https://zhishun520.com/zttH5/videoShare.html?device=0&packageName=com.muki.topline&userId=349&videoOsType=android&z****znewsUrl=http://p0.qhimg.com/video/568_320_70/t01612fa5b9a8ec0df3.webp&infoId=qDrvmA4Q1Z6e&z****zTitle=中国女排3-1胜荷兰进奥运决赛&channelId=12&appVersion=1.2.3&idImei=864594037502421&osVersion=1.1.1&channel=sanliuling&type=1&urls=video/list&invitation=45a856bcb&height=1136&domain=https://zhishun888.com:9443/toutiaotv-api-home-1.0.0/&idIdfa=(UIDevice.current.identifierForVendor?.uuidString)!&backdata=1&osType=1&z****zlink=&brand=apple&width=22&ip=49,57,50,46,49,54,56,46,48,46,49,50,52&userAgent=Mozilla/5.0 (Linux; Android 7.0; PRO 7-S Build/NRD90M; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/51.0.2704.110 Mobile Safari/537.36&model=iPhone6";//android		*/		
			var urlResult = decodeURI(videoUrl).split("****");
			var urlPara = urlResult[0].split("?")[1];
			/**
			 * 获取Url地址中userId参数   userID
			 */
			console.log("参数",urlPara);
			function getUrlParams(name) {  
			    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); //定义正则表达式 
			    var r = urlPara.substr(urlPara.indexOf("?")+1).match(reg);   
			    if (r != null) return unescape(r[2]); 
			    return null; 
			};			
			/**
			 *   @param    
			 *   device:设备名称（0为安卓，1为iOS，2为PC）;
			     userId:用户ID;
			     packageName：app包名；
			     appVersion：app版本号；
			     idIdfa：ios为idfa;
			     idImei: android为imei;
			     height: 屏幕的物理高度，以像素为单位；
			     width：屏幕的物理宽度，以像素为单位；
			     brand：设备品牌；
			     model：设备型号；
			     osVersion：设备操作系统版本号，例如3.1.2，需要三位数；
			     osType: 操作系统类型 1.ANDROID 2.IOS 3.WP；
			     type: 设备网络环境 1.WIFI 2.UNKNOWN 3.2G 4.3G 5.4G；
			     ip: 设备当前ip；
			     domain：站点主域；
			     urls: 当前页面；
			     userAgent：浏览器的UA			     
			     link:深度链接
			 */
			var videoOsType = getUrlParams("videoOsType");
			var device = getUrlParams("device");
			var userId = getUrlParams("userId");
			var extdata = getUrlParams("extdata");
			var packageName = getUrlParams("packageName");
			var appVersion = getUrlParams("appVersion");
			var page = getUrlParams("page");
			var idIdfa = getUrlParams("idIdfa");
			var idImei = getUrlParams("idImei");
			var height = getUrlParams("height");
			var width = getUrlParams("width");
			var brand = getUrlParams("brand");
			var model = getUrlParams("model");
			var osVersion = getUrlParams("osVersion");
			var osType = getUrlParams("osType");
			var type = getUrlParams("type");
			var ip = getUrlParams("ip");
			var domain = getUrlParams("domain");
			var urls = getUrlParams("urls");
			var userAgent = navigator.userAgent;
			var id = getUrlParams("infoId");//详情
			var title = urlResult[1].split("zTitle=")[1];//标题
			var channel = getUrlParams("channel");//深度链接渠道
			var invitation = getUrlParams("invitation");//标题
			console.log({
				"userId":userId,
				"id":id,
			    "extdata":extdata,
			    "page":page,			     
			     "packageName":packageName,
			     "appVersion":appVersion,
			     "idIdfa":idIdfa,
			     "idImei": idImei, 
			     "height": height,
			     "width":width,
			     "brand":brand,
			     "model":model,
			     "osVersion":osVersion,
			     "osType": osType,
			     "type": type, 
			     "ip": ip,
			     "domain":domain,
			     "urls": urls,
			     "userAgent":userAgent,
			     "title":title,
			     "channel":channel,
			     "invitation":invitation
			  });
			/**
			 * 新闻标题
			*/
			document.title = title;
		 	/**
		    * 视频链接
		    */
		   axios({	
			  url: '/video/datil',
			  method: 'get', // 默认是 get
			  baseURL: ajaxUrl,
			  params: {
			  	userId:userId,
			  	osType:osType,
			    id:id,
			    extdata:extdata,
			    ip:ip
			  }
			})
			.then(function(res){
				console.log("视频详情链接",res);
				//视频信息
				var item = res.data.data;
				$(".vjs-poster").css("background-image","url("+item.url+")");
				$(".vjs-tech").attr("src",item.cdnUrl.replace("http://","https://"));
				$(".videoName").html(item.title);
				$(".videoSource").html(item.author);
				$(".playCnt").html(item.playCnt?item.playCnt:0);
				document.title = item.title;															
			})
			.catch(function(error){
				console.log(error);
			});
			var uploadReVideo = function(){
				axios({
				  url: '/video/related',
				  method: 'get', // 默认是 get
				  baseURL: 'https://zhishun888.com:9443/toutiaotv-api-home-1.0.0/',
				  params: {
				  	 userId:userId,
				     videoOsType:videoOsType,
				     id:id,
				     extdata:extdata,
				     page:1,
				     packageName:packageName,
				     appVersion:appVersion,
				     idIdfa:idIdfa,
				     idImei: idImei, 
				     height: height,
				     width:width,
				     brand:brand,
				     model:model,
				     osVersion:osVersion,//设备操作系统版本号，例如3.1.2，需要三位数；
				     osType: osType, //1.ANDROID 2.IOS 3.WP；
				     type: type, //1.WIFI 2.UNKNOWN 3.2G 4.3G 5.4G；
				     ip: ip,//设备当前ip；
				     domain:domain,//站点主域；
				     urls: urls,//当前页面；
				     userAgent:userAgent,//浏览器的UA
				  }
				  })
				.then(function(res){
					/*alert("appVersion",appVersion);*/
				  	console.log("相关视频",res);
				  	var _html = "";	
				  	console.log(res.data.data);
				  	res.data.data.forEach(function(item,index){
				  		var timeDiff = new Date() - new Date(item.obj.createDate).getTime();
				  		if(item.type==0){
				  			var time1 = new Date().getTime();
				  			var time2 = getTs(item.obj.createDate);
				  			var timeDiff = time1-time2;
				  			var playCnt;
				  			console.log(item);
				  			if(item.obj.playCnt.length>5||item.obj.playCnt.length==5){
				  				playCnt = item.obj.playCnt.substr(0,item.obj.playCnt.length-4)+"万";
				  			}else{
				  				playCnt = item.obj.playCnt;
				  			}
				  			_html += 
				  			'<a href="#" onclick="playVideo('+"'"+item.obj.id+"','"+item.obj.extdata+"'"+')">'
								+'<li class="items">'
									+'<div class="leftCon">'
										+'<p>'+item.obj.title+'</p>'
										+'<div class="itemsInfor">'
											+'<span>'+item.obj.author+'</span>'
											+'<span>'+countdown(timeDiff)+'</span>'
											+'<span>'+playCnt+'</span>阅读'
										+'</div>'
									+'</div>'
									+'<div class="rightImg">'
										+'<img src="'+item.obj.url+'" alt="" />'
									+'</div>'
								+'</li>'
							+'</a>';
				  		}else if(item.type == 2){
				  			console.log("广告",index);
				  			_html += 
				  			'<a href="'+ item.obj.cUrl+'">'
						  		+'<li class="items">'
									+'<div class="leftCon">'
										+'<p>'+item.obj.title+'</p>'
										+'<div class="itemsInfor">'
											+'<span>广告</span>'								
										+'</div>'
									+'</div>'
									+'<div class="rightImg">'
										+'<img src="'+item.obj.url+'" alt="" />'
									+'</div>'
								+'</li>'
							+'</a>';
				  		}					
				  	})		
				  	/*console.log("_html渲染内容",_html);*/
				  	//渲染相关推荐
				  	$(".newsList").eq(0).html(_html);
				 })
				.catch(function(error){
					console.log(error);
				});
			};
			uploadReVideo();
			/**
			 * 相关推荐获取视频地址
			 */
			function playVideo(idRe,extdataRe){
				var videoReOsType;
				switch(osType){
					case "1" : 
					videoReOsType = "android";
					break;
					case "2" : 
					videoReOsType = "ios";
					break;
					case "3" : 
					videoReOsType = "pc";
					break;
					default:
					break;
				}
				console.log({
					"userId":userId,
				  	"os_type":videoReOsType,
				    "id":idRe,
				    "extdata":extdataRe,
				    "ip":ip
				});
				axios({	
				  url: '/video/datil',
				  method: 'get', // 默认是 get
				  baseURL: 'https://zhishun888.com:9443/toutiaotv-api-home-1.0.0/',
				  params: {
				  	userId:userId,
				  	osType:videoReOsType,
				    id:idRe,
				    extdata:extdataRe,
				    ip:ip
				  }
				})
				.then(function(res){
					console.log("相关视频详情链接",res);
					//视频信息
					var item = res.data.data;
					$(".vjs-poster").css("background-image","url("+item.url+")");
					$(".vjs-tech").attr("src",item.cdnUrl);
					$(".videoName").html(item.title);
					$(".videoSource").html(item.author);
					$(".playCnt").html(item.playCnt?item.playCnt:0);
					document.title = item.title;															
					uploadReVideo();
				})
				.catch(function(error){
					console.log(error);
				});
			}
			/**
			 * 时间计时
			 */
			function countdown(leftTime){				
				var d,h,m,s; 
				var showTime;
                if(leftTime>=0){  
	                 d = Math.floor(leftTime/1000/60/60/24);  
	                 h = Math.floor(leftTime/1000/60/60%24);  
	                 m = Math.floor(leftTime/1000/60%60);  
	                 s = Math.floor(leftTime/1000%60);                     
	            }  
/*	            //将倒计时赋值到div中  				
				console.log(`${h}:${m}:${s}`);*/
				if(m!=0&&h===0){
					if(m=="undefiend"){showTime = "刚刚";}
					showTime = m+"分钟前";
				}else if(m===0){
					if(s=="undefiend"){showTime = "刚刚";}
					showTime = s+"秒前";
				}else if(h!=0){	
					if(h=="undefiend"){showTime = "刚刚";}
					showTime = h+"小时前";
				}
				return showTime;
				/*console.log(showTime);*/
			};
						/**
			 * 获取时间戳兼容问题
			 */
			function getTs(time){  
			    var arr = time.split(/[- :]/),  
			    _date = new Date(arr[0], arr[1]-1, arr[2], arr[3], arr[4], arr[5]),  
			    timeStr = Date.parse(_date)  
			    return timeStr  
			}  
			
	</script>
	<script src="https://static.lkme.cc/linkedme.min.js" ></script>
	<script src="./js/linkedME/linkedME.js" ></script>
</html>
</html>



